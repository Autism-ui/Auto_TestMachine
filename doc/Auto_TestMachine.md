# 自动化测试子项（目标）：
## ADC
-  电源电压————例如：电池、电容、主电源、5V、4V、3.3V
-  点火电流
18 x 14 1.25us
## IO
- 继电器通断
- 接口通信能力————例如：CAN、UART、USB、PWM、GPIO、LED/BEEPER

## UART交互
- 存储器自检(FLASH\SD)
- 固件版本等其他自检信息
- 传感器静态数值
- 传感器动态数值
- 设置SN码，硬件版本，校准信息等工厂配置项

## 选型
暂定STM32：STM32f407 ? yes or no
可能遇到的问题：
1. LCD的界面

# 测试方案

## ADC测试方案
如果选型STM32F4的话是有3个ADC采集模块的（19个通道，可以测量16个外部源、2个内部源和Vbat通道信号）

### 电源电压
**测试方式**
0. 暂定：利用单片机的*ADC模块*对外部源进行测量
1. 利用串口*发送指令*给UPF输出电压和电流
2. 设定阈值，满足阈值的输出 PASS，小于阈值或者大于阈值的输出 FAILED
### 点火电流
同上


## IO测试方案

### 继电器通断
**测试方式**
0. 因为继电器的通断就是控制IO口输出高低电平，因此我们可以通过串口发送指令给UPF连接继电器的引脚输出高低电平（低关高开），检测是否通断正常。
代码逻辑：
   - 设置命令码使UPF开关继电器，同时检测UPF引脚的电压值，总共发送两次，一次是开（高电平），一次是关（低电平）
   - 用F4接收传递回来的两个数据，利用接收到的数据判断是否符合条件。在此之前先用memset清除DMA缓冲区中的数据。


### 接口通信能力————例如：CAN、UART、USB、PWM、GPIO、LED/BEEPER
**测试方式**：
0. 通过监测来进行测试，所有的通信接口都按照这种方法：
- A端发送命令给B端，B接收到*命令码*之后开始相应模块的测试，需要产品在*测试模式*下进行。

1. CAN、UART、USB 接口 通过两个平台之间的数据收发来进行测试。
具体如下：
    - A端（*测试端*）发送数据给B端（*产品端*），A端发送的数据可以命令码的模式，发送命令给B端，B端接收到命令之后发回，A端在*数据校验*通过之后确认B端通信能力 PASS 或者 NO PASS。
  

2. PWM、GPIO 接口 发送数据到测试机
具体如下：
    - A端同样发送命令到B端，B接收到命令之后发出PWM信号（或者是IO信号），A端对信号进行检测。A端检测完成之后判断PASS　或者是　NO PASS。

    - 对于PWM：
        - 使用PWM的输入捕获模式进行波形捕获。需要关注的点：
            - 占空比
            - 周期\频率
            查看这两个点是否正常，按照规定的需求

    - 对于GPIO：
        - 测试机配置IO输入模式，接收产品IO输出高低电平（高低电平的排序按照*规定好的协议*来，例如110011，如果发过来的和测试机预先设置好的变量相等，那么输出 PASS 否则 NO PASS） 

3. LED/BEEPER 测试机发送命令到产品，产品通过命令码执行相应的操作。（通过*串口*发送）
具体如下：
    - 例如命令码为`0x01`，那么产品开始打开所有的RGB灯，如果颜色符合规定，那么可以人为 PASS，如果不通过...。
      - 待定：
    - 例如命令码为`0x02`，那么产品蜂鸣器响，如果蜂鸣器正常运作那么人为 PASS。
      - 优化：
        - 后期需要加入陶瓷声压传感器（检测是否有声音）
        - 频率周期检测（检测是否有输出）


## UART交互方案

### 存储器自检
现有对**存储器**进行检测的方法有： 
1. 通常为随机读取存储器存储区域数据，只要能够正常读取数据，则表示存储正常；
2. 通常在存储器中开辟专用测试位置，先擦除该区域数据，然后在该位置先写入用户特殊的测试数据，最后读取写入的测试数据，
并与写入的测试数据进行比较，如果读取的和写入的测试数据一致，则表示合格。
*FLASH*
*USB(虚拟串口\U盘模式)*

### 固件版本等其他自检信息
**测试方法**
暂定：
    - 根据通用协议统一打包发送信息给测试仪（终项 —— 测试完之后在统一比对固件版本）。
1. 对于*固件版本*进行字符串的比对
2. 对于*其他自检信息*利用表格的方法进行比对（*表格上的数据都是如果通过了的正确数据*），如果有一项不通过，直接NOPASS


### 传感器静态数值
**测试方式**
同下

### 传感器动态数值
**测试方式**
0. 利用串口发送命令给UPF输出当前传感器的值
1. 固定放UPF的平台，利用双轴\多轴运动测试陀螺仪的数值是否正常
2. 其他同理，着重点关注在各传感器是否有数据输出，输出的数据是否正常


### 设置SN码，硬件版本，校准信息等工厂配置项
**设置方式**
0. 在UPF写个接口传进测试仪输入的SN码、硬件版本、校准信息等工厂配置项


